// Generated by CoffeeScript 1.10.0
var Obj, Settings, bind_ui_actions, error_graph, init_graph, parse_graph;

Settings = {
  active_menu_class: "context-menu--active",
  context_menu: {
    ".element": "#context-menu",
    "svg": "#context-menu2"
  },
  ui: {
    actions: {
      "Add": metabook.ui.add,
      "Edit": metabook.ui.edit,
      "Delete": metabook.ui["delete"]
    }
  },
  id: {
    messages: "#messages",
    coords: "#coords",
    graph_container: "#paper_holder",
    paper: "#myholder",
    svg: "#v-2"
  }
};

Obj = {
  graph: void 0,
  mainpaper: void 0
};

$(document).ready(function() {
  var WebSocketTest, counter, makeCounter, messageContainer;
  WebSocketTest = void 0;
  messageContainer = $(Settings.id.messages);
  WebSocketTest = function(ev) {
    var ws;
    messageContainer.text("WebSocket is supported by your Browser!");
    ws = new WebSocket("ws://" + window.location.host + "/api/session/guise?Id=123456789");
    ws.onopen = function() {
      $('#bSend').on("click", function() {
        return ws.send("New message");
      });
      $('#bClose').on("click", function(ev) {
        ws.close();
        $(messageContainer).text("Connection is forcefully closed");
        $(ev.target).addClass("disabled");
        $('#bSend').addClass("disabled");
        return $('#bConnect').removeClass("disabled");
      });
      $('#bClose').removeClass("disabled");
      $('#bSend').removeClass("disabled");
      return $(ev.target).addClass("disabled");
    };
    ws.onmessage = function(evt) {
      var received_msg;
      received_msg = evt.data;
      return $(messageContainer).text("Message is received..." + received_msg);
    };
    return ws.onclose = function() {
      return $(messageContainer).text("Connection is closed...");
    };
  };
  $('#bConnect').on("click", WebSocketTest);
  makeCounter = function() {
    var count;
    count = 0;
    return {
      increment: function() {
        return count++;
      },
      getCount: function() {
        return count;
      }
    };
  };
  counter = makeCounter();
  $('#bTest1').on("click", function() {
    counter.increment();
    return alert(counter.getCount());
  });
  $("#id2").dimmer({
    closable: false
  }).dimmer('show');
  return metabook.api.get_template(init_graph, error_graph);
});

init_graph = function(graph_template) {
  if (metabook.api.file_id !== "") {
    return metabook.api.get_file(_.partial(parse_graph, graph_template), error_graph);
  } else {
    return parse_graph(graph_template, {});
  }
};

parse_graph = function(graph_template, graph_json) {
  var cells_collection, menuview, notebook;
  if (Object.keys(graph_json).length === 0) {
    graph_json = graph_template;
  } else if (!'metabook' in graph_json.metadata) {
    graph_json.metadata.metabook = graph_template.metadata.metabook;
    graph_json.metadata.metabook.id = joint.util.uuid();
  }
  cells_collection = init_jointjs(graph_template, graph_json);
  notebook = new metabook.models.MetabookModel({
    'cells': cells_collection
  }, {
    template: graph_template,
    json: graph_json
  });
  $("#id2").dimmer('hide');
  $("#uiLeftSidebar").sidebar({
    context: $('#id2')
  });
  $("#uiLeftSidebar").sidebar('setting', 'transition', 'overlay');
  $("#uiLeftSidebar").sidebar('setting', 'dimPage', false);
  $("#uiLeftSidebar").sidebar('attach events', '#uiMenuToggle');
  $("#uiLeftSidebar").sidebar('setting', 'closable', false);
  ContextMenu.init(Settings);
  bind_ui_actions(Settings);
  jointjs_attach_events(Obj.mainpaper, Obj.graph);
  return menuview = new metabook.views.MenuView({
    el: $(".menu"),
    model: notebook
  });
};

bind_ui_actions = function(settings) {
  return $("[data-action]").on('click', function(e) {
    var action, actions;
    action = e.target.dataset.action;
    actions = Settings.ui.actions;
    if (action in actions) {
      ContextMenu.active_menu_off();
      return actions[action].apply(this, arguments);
    }
  });
};

error_graph = function(e) {
  $("#id2").dimmer('hide');
  return alert("Connection error. Check if your backend is running.");
};

//# sourceMappingURL=graph.js.map
