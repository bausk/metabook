// Generated by CoffeeScript 1.10.0
(function() {
  var error_graph, init_graph;

  $(document).ready(function() {
    var global_gui, imports, message, session, uivent;
    imports = {
      ui: require("./ui"),
      connect: require("./connect"),
      data: require("./data"),
      messages: require("./ui_messages"),
      settings: require("./settings")
    };
    message = new imports.messages.SessionDisconnectedMessage({
      el: imports.settings.id.globalmessages
    });
    uivent = new imports.ui.Vent();
    uivent.register({
      'ui': imports.ui
    });
    global_gui = new imports.ui.GlobalGUI();
    session = new imports.connect.Session(config.sessions_endpoint);
    session.connect_metabook(config.file.path);
    return imports.data.get_xhr(config.file.endpoint + config.file.path).done(function(file_json) {
      return init_graph(file_json);
    }).fail(error_graph);
  });

  init_graph = function(json_graph) {
    var menuview, notebook, paper;
    notebook = new metabook.models.MetabookModel({}, {
      json_graph: json_graph
    });
    paper = init_jointjs(notebook);
    notebook.session = new metabook.connect.Session(config.sessions_endpoint, notebook.id);
    $("#id2").dimmer('hide');
    $("#bottom_sidebar").sidebar({
      context: $('#id2')
    });
    $("#bottom_sidebar").sidebar('setting', 'transition', 'overlay');
    $("#bottom_sidebar").sidebar('setting', 'dimPage', false);
    $("#bottom_sidebar").sidebar('attach events', '#uiMenuToggle');
    $("#bottom_sidebar").sidebar('setting', 'closable', false);
    uivent.register({
      'session': notebook.session,
      'model': notebook,
      'graph': paper.model
    });
    jointjs_attach_events(paper, paper.model);
    return menuview = new metabook.views.MenuView({
      el: $("#metabook_top_menu"),
      model: notebook
    });
  };

  error_graph = function(e) {
    $("#id2").dimmer('hide');
    return alert("Connection error. Check if your backend is running.");
  };

}).call(this);

//# sourceMappingURL=init.js.map
